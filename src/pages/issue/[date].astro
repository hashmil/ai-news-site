---
import Base from '../../layouts/Base.astro';
import Section from '../../components/Section.astro';
import Story from '../../components/Story.astro';
import briefings from '../../data/briefings.json';
import imageMap from '../../data/image-map.json';

export function getStaticPaths() {
  return briefings.map((b, i) => ({
    params: { date: b.date },
    props: {
      briefing: b,
      newer: briefings[i - 1] ?? null,
      older: briefings[i + 1] ?? null,
      isLatest: i === 0,
    },
  }));
}

const { briefing, newer, older, isLatest } = Astro.props;
---
<Base title={briefing.date} description={`${briefing.title} â€” Daily AI news briefing.`} canonicalPath={`/issue/${briefing.date}/`}>
  <span class="date-header">{briefing.title}</span>
  {briefing.sections.map((section) => (
    <Section heading={section.heading}>
      {section.stories.map((story) => (
        <Story
          number={story.number}
          headline={story.headline}
          description={story.description}
          url={story.url}
          imageUrl={(imageMap as Record<string, string | null>)[story.url]}
          sectionType={section.type}
        />
      ))}
    </Section>
  ))}
  <nav class="issue-nav">
    {newer ? (
      <a href={isLatest ? '/' : `/issue/${newer.date}/`} class="issue-nav-link">&larr; Newer</a>
    ) : <span></span>}
    {older ? (
      <a href={`/issue/${older.date}/`} class="issue-nav-link">Older &rarr;</a>
    ) : <span></span>}
  </nav>
</Base>
